all: install

add: remove
	\/bin/rm -rf /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@
	mkdir /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@
	cd @DRV_TYPE@-@DRV_VERSION@-DNA/src ; cp -r * /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@
	cd @DRV_TYPE@-@DRV_VERSION@-DNA/src ; cp ../../../../kernel/linux/pf_ring.h /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@
	sed -i -e 's|../../../../kernel/linux/pf_ring.h|pf_ring.h|g' /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@/*.c
	sed -i -e 's|../../../../kernel/linux/pf_ring.h|pf_ring.h|g' /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@/*.h
	sed -i -e 's|DRIVER_NAME=@DRV_TYPE@|DRIVER_NAME=@DRV_TYPE@-dna|g' /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@/Makefile
	cp dkms.conf /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@ 
	dkms add -m @DRV_TYPE@-dna -v @DRV_VERSION@

build: add
	dkms build -m @DRV_TYPE@-dna -v @DRV_VERSION@

install: build
	dkms install -m @DRV_TYPE@-dna -v @DRV_VERSION@

deb: add add_deb install
	dkms mkdeb -m @DRV_TYPE@-dna -v @DRV_VERSION@ --source-only

rpm: add add_rpm install
	dkms mkrpm -m @DRV_TYPE@-dna -v @DRV_VERSION@ --source-only

add_rpm:
	cp -r @DRV_TYPE@-dna-dkms-*.spec /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@/

add_deb:
	cp -r @DRV_TYPE@-dna-dkms-mkdeb /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@/

remove:
	-dkms remove -m @DRV_TYPE@-dna -v @DRV_VERSION@ --all

veryclean: remove
	\/bin/rm -fr /usr/src/@DRV_TYPE@-dna-@DRV_VERSION@
	
